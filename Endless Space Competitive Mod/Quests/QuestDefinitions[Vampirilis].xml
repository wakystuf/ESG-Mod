<?xml version="1.0" encoding="utf-8" ?>
<Datatable xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xsi:noNamespaceSchemaLocation="../Schemas/QuestDefinition.xsd">
    
    <!-- ####################################### -->
    <!--               VAMPIRILIS QUEST            -->
    <!-- ####################################### -->
  

    <!-- ##### VAMPIRILIS QUEST 00: Choose which system gen quest to use #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0" Category="MajorQuest" SubCategory="" MinimumTurn="0" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,BeginTurn</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                        NumberOfOccurrencesPerEmpire="1"
                        NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$Expression01" StringValue="ClassEmpire/ClassColonizedStarSystem/ClassColonizedPlanet,UniquePlanetVampirilis"/>
        </Vars>
        <!--============ PREREQUISITES ============-->
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityVampirilis,PopulationMajor</PathPrerequisite>      
        </Prerequisites>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence> 
                            <Decorator_MothershipAttached Initiator="Empire">
                                <Input_System VarName="$HomeSystem"/>
                            </Decorator_MothershipAttached>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-3</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-4</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-5</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-6</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-7</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-8</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-9</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-10</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-11</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-12</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-13</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-14</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-15</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step2-16</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-1" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-1</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis1"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter0-Step3</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-2" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-2</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis2"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-3" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-3</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis3"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-4" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-4</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis4"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-5" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-5</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis5"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-6" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-6</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis6"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-7" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-7</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis7"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-8" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-8</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis8"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-9" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-9</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis9"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-10" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-10</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis10"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-11" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-11</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis11"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-12" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-12</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis12"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-13" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-13</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis13"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-14" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-14</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis14"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-15" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-15</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis15"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST 00: System gen option #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step2-16" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step2-16</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$DefinitionName" StringValue="HomeNodeVampirilis16"/>
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyStarSystemDefinition>
                            <Input_DefinitionName VarName="$DefinitionName"/>
                            <Input_StarSystemNode VarName="$HomeSystem"/>
                        </Action_ApplyStarSystemDefinition>                 
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>


    <!-- ##### VAMPIRILIS QUEST 00: Clean up after system overwrite #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter0-Step3" Category="MajorQuest" SubCategory="" IsInstant="true">
        <!--============ TAGS ============-->
        <Tags>Hidden,VampirilisQuest-Chapter0-Step3</Tags>
        <QuestContextSolo/>
        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>
        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <!--<Var VarName="$HomeArk">
                <From Source="$CurrentEmpire">
                    <Where>                                   
                        <PathPrerequisite Inverted="false" Flags="Prerequisite">ClassEmpire//ClassShip,ClassMothership</PathPrerequisite>
                    </Where>                 
                </From>
            </Var>-->
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$HomePlanet">
                <Any>
                    <From Source="$HomeSystem.$Planets">
                        <Where>
                            <PathPrerequisite Inverted="false" Flags="Prerequisite">ClassPlanet,UniquePlanetVampirilis</PathPrerequisite>
                        </Where>
                    </From>
                </Any>
                <!--<From Source="$HomeSystem.$UniquePlanetVampirilis"/>-->
            </Var>
            <!-- <Var VarName="$DockArk" StringValue="FleetActionMothershipAttached"/> -->
        </Vars>
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions> <!--
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$DockArk"/>
                            <Input_Targets VarName="$HomeArk"/>
                        </Action_ApplyDescriptor>-->
                        <Action_Colonize>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Planet VarName="$HomePlanet"/>
                        </Action_Colonize>               
                    </StartActions>
                    <Objective Name="Step1_Objective1">                        
                        <Sequence>
                            <Decorator_BeginTurn></Decorator_BeginTurn>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- ##### VAMPIRILIS QUEST CHAPTER 1 #####-->
    <QuestDefinition Name="VampirilisQuest-Chapter1" Category="MajorQuest" SubCategory="Vampirilis" MinimumTurn="5">

        <!--============ TAGS ============-->
        <Tags>BeginTurn,VampirilisQuest-Chapter1</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <Vars>
            <!--Define Location where we spawn Pirate fleet-->
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>          
         
            <!--The pirate location shouldn't be on isolated node-->
            <Var VarName="$ConstellationStarSystems">
                <From Source="$HomeSystem.$Constellation.$StarSystems">
                    <Where>                                   
                        <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem,IsolatedNode</PathPrerequisite>
                        <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>                     
                    </Where>                 
                </From>
             </Var>
            <!--Take several System where we spawn fleet, avoiding puting on the same node-->
            <Var VarName="$StarSystemToChoose">                
                    <From Source="$ConstellationStarSystems">
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Farthest" MinimumDistance="10" MaximumDistance="25" MinimumCandidateCount="2"/>
                        </OrderBy>
                    </From>  
            </Var>
            <!--Take 2 Systems-->
            <Var VarName="$StarSystem01" IgnoreLockedTargets="true">
                <First>
                    <From Source="$StarSystemToChoose"/>
                </First>
            </Var>
            <Var VarName="$StarSystem02" IgnoreLockedTargets="true">
                <First>
                    <From Source="$StarSystemToChoose">
                        <Where>
                            <IsNot EntityVarName="$StarSystem01"/>
                        </Where>
                    </From>
                </First>
            </Var>

            <!--Define the Fleets we want to spawn-->
            <DroplistVar VarName="$FleetToSpawn01" Droplist="PirateFleet01"/>
            <Var VarName="$PirateShipDesign" StringValue="ShipDesignSmallAttackerPirate01"/>
            <Var VarName="$GUID01"/>
            <DroplistVar VarName="$FleetToSpawn02" Droplist="PirateFleet01"/>
            <Var VarName="$GUID02"/>            
            <!--Define the Lesser Empire-->
            <Var VarName="$OtherEmpire">
                <Any>
                    <From Source="$LesserEmpire">
                    </From>
                </Any>
            </Var>
            <!--Fleet Behaviours-->
            <Var VarName="$FleetMissionDefinitionName01" StringValue="DefendSystem"/>
            <Var VarName="$FleetMissionDefinitionName02" StringValue="DefendSystem"/>
            <Var VarName="$MissionGUID1"/>
            <Var VarName="$MissionGUID2"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Marker02"/>         
            <!--Localization given-->
            <LocalizationVar VarName="$SystemName01" Source="$StarSystem01"/>
            <LocalizationVar VarName="$SystemName02" Source="$StarSystem02"/>

            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis01Religious"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
        </Vars>
        
        <!--============ PREREQUISITE ============-->
        <Prerequisites Target="$(Empire)">
            <PathPrerequisite Flags="Prerequisite">EmpireTypeMajor/ClassPopulation,ClassPopulationEmpireAffinityVampirilis,PopulationMajor</PathPrerequisite>      
        </Prerequisites>
        
        <!--============ STEPS ============-->
        <Steps>
            <!--============ STEP 1 ============-->
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                        <!--Spawn the First Fleet-->
                        <Action_SpawnFleets>
                            <Input_Empire VarName="$OtherEmpire"/>
                            <Input_Locations VarName="$StarSystem01"/>
                            <Input_DroppableFleet VarName="$FleetToSpawn01"/>
                            <Output_FleetGUIDs VarName="$GUID01"/>
                        </Action_SpawnFleets>
                        <!--Assign a behavior to it-->
                        <Action_CreateFleetMissions>
                            <Input_MissionDefinitionName VarName="$FleetMissionDefinitionName01"/>
                            <Input_FleetGUIDs VarName="$GUID01"/>
                            <Input_TargetEmpires VarName="$CurrentEmpire"/>
                            <Output_MissionGUIDs VarName="$MissionGUID1"/>
                        </Action_CreateFleetMissions>
                        <!--Spawn the Second Fleet-->
                        <Action_SpawnFleets>
                            <Input_Empire VarName="$OtherEmpire"/>
                            <Input_Locations VarName="$StarSystem02"/>
                            <Input_DroppableFleet VarName="$FleetToSpawn02"/>
                            <Output_FleetGUIDs VarName="$GUID02"/>
                        </Action_SpawnFleets>
                        <!--Assign a behavior to it-->
                        <Action_CreateFleetMissions>
                            <Input_MissionDefinitionName VarName="$FleetMissionDefinitionName02"/>
                            <Input_FleetGUIDs VarName="$GUID02"/>
                            <Input_TargetEmpires VarName="$CurrentEmpire"/>
                            <Output_MissionGUIDs VarName="$MissionGUID2"/>
                        </Action_CreateFleetMissions>
                        <!--Add a Quest Marker for the first Fleet-->
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem01"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <!--Add a Quest Marker for the second Fleet-->
                        <Action_AddQuestMarkers>
                            <Input_Targets VarName="$StarSystem02"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker02"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="0" EndValue="2">
						<AIHint Category="DestroyFleet" Motivation="0.7">
							<Input_Var VarName="$GUID01"/>
							<Input_Var VarName="$GUID02"/>
						</AIHint>
                        <Sequence>
                            <!--Destroy all the Pirate fleets-->
                            <!--No matter which one first-->
                        <Parallel CompletionPolicy="All">
                            <Sequence>
                                <!--All battles increase the progression Increment in Objective-->
                                <!--Be aware that all Empires can defeat those fleet including Minor Factions-->
                                <Decorator_BattleEnded Status="Won" ProgressionIncrement="1">
                                    <Condition_BattleEnded_FleetDestroyed>                                        
                                        <Input_FleetGUIDs VarName="$GUID01"/>                                        
                                    </Condition_BattleEnded_FleetDestroyed>                                    
                                </Decorator_BattleEnded>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker01"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>                            
                            <Sequence>
                            <Decorator_BattleEnded Status="Won" ProgressionIncrement="1">
                                <Condition_BattleEnded_FleetDestroyed>
                                    <Input_FleetGUIDs VarName="$GUID02"/>                                    
                                </Condition_BattleEnded_FleetDestroyed>                                   
                            </Decorator_BattleEnded>
                                <Action_RemoveQuestMarkers>
                                    <Input_Markers VarName="$Marker02"/>
                                </Action_RemoveQuestMarkers>
                            </Sequence>                                                    
                        </Parallel>
                            <!--Take the corresponding outcome: drive to the right chapter-->
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuestChapter1.2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                </ObjectiveSet>
                <Reward Droplist="DroplistStrategicsEra2" Picks="1"/>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--         VAMPIRILIS QUEST Chapter1 - STEP2   -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter1-Step2" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuestChapter1.2</Tags>

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            
            <Var VarName="$MyHomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <!--Define at least 4 Systems: they should correspond to the defined distance.-->
            <!--But the "Mimimum Candidate Count" provide at least 4 "near" systems  -->
            <Var VarName="$StarSystemToChoose">
                <From Source="$Constellations.$StarSystems">
                    <Where>
                        <PathPrerequisite Inverted="true" Flags="Prerequisite">ClassStarSystem, QuestNode</PathPrerequisite>
                    </Where>
                    <OrderBy>                        
                        <SortSystemByDistance OriginVarName="$MyHomeSystem" SortBy="Nearest" MinimumDistance="1" MaximumDistance="60" MinimumCandidateCount="4"/>
                    </OrderBy>
                </From>
            </Var>
            <!--Define Where to spawn the Curiosities: be sure this objective will not take to many time-->
            <Var VarName="$FirstSystem">
                <First>
                    <From Source="$StarSystemToChoose"/>                    
                </First>
            </Var>
            <Var VarName="$FirstSystemPlanet">
                <Any>
                    <From Source="$FirstSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$SecondSystem">
                <First>
                    <From Source="$StarSystemToChoose">
                        <Where>
                            <IsNot EntityVarName="$FirstSystem"/>
                        </Where>
                    </From>
                </First>
            </Var>
            <Var VarName="$SecondSystemPlanet">
                <Any>
                    <From Source="$SecondSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$ThirdSystem">
                <First>
                    <From Source="$StarSystemToChoose">
                        <Where>
                            <IsNot EntityVarName="$FirstSystem"/>
                            <IsNot EntityVarName="$SecondSystem"/>
                        </Where>
                    </From>
                </First>
            </Var>
            <Var VarName="$ThirdSystemPlanet">
                <Any>
                    <From Source="$ThirdSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$FourthSystem">
                <First>
                    <From Source="$StarSystemToChoose">
                        <Where>
                            <IsNot EntityVarName="$FirstSystem"/>
                            <IsNot EntityVarName="$SecondSystem"/>
                            <IsNot EntityVarName="$ThirdSystem"/>
                        </Where>
                    </From>
                </First>
            </Var>
            <Var VarName="$FourthSystemPlanet">
                <Any>
                    <From Source="$FourthSystem.$Planets"/>
                </Any>
            </Var>
            <!--Will be visible only for the Current Empire-->
            <Var VarName="$CuriosityName" StringValue="Curiosity_Loot_Ruins_Era1"/>
            <Var VarName="$CuriosityType" StringValue="CuriosityTypeRuins"/>
            <!--How many time the Curiosities will be spawned. Min, the loop will be used once-->         
            <InterpretedVar VarName="$CuriositySpawnLoop" Target="$(Empire)">
                <Expression>Min(1,(Property(Context, @../ClassEmpire, GameSpeedMultiplier, true)*1))</Expression>
            </InterpretedVar>
            <!--How many curiosities the player has to search depending on the game speed-->
            <InterpretedVar VarName="$CuriosityAmount" Target="$(Empire)">
                <Expression>Property(Context, @../ClassEmpire, GameSpeedMultiplier, true) *4</Expression>
            </InterpretedVar>
            <!--Quest requirement lowered to only require cordial relations, not assimilation-->
            <Var VarName="$RelationState" StringValue="DiplomaticRelationStateMinorCordial"/>           
            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis01.2Religious"/>
            
            <LocalizationVar Source="$CuriosityAmount" LocalizationKey="$CuriosityAmountName"/>
            
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <!--============ STEP 0 - Choose ============-->
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                </Choice>
                <!--============ STEP 1 Choice 0 - Neutral ============-->
                <ObjectiveSet>
                    <Objective Name="Step2_1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Parallel CompletionPolicy="Any">
                            <Sequence>
                                <!--Become "Cordial"-->
                                <Decorator_DiplomaticRelationChanged Initiator="Empire">                                  
                                    <Input_DiplomaticRelationState VarName="$RelationState"/>
                                </Decorator_DiplomaticRelationChanged>
                                <Action_ChooseOutcome Name="Outcome1"/>
                            </Sequence>
                            <Sequence>
                                <Decorator_MinorEmpireIntegrated Initiator="Empire">                               
                                </Decorator_MinorEmpireIntegrated>
                                <Action_ChooseOutcome Name="Outcome1"/>
                            </Sequence>
                        </Parallel>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistPacifistChapter1" Picks="1"/>
                </ObjectiveSet>
                <!--============ STEP 1 Choice 1 - RELIGIOUS ============-->
                <ObjectiveSet>                    
                    <StartActions>
                        <!--Increase Religion-->
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>                        
                    </StartActions>                    
                    <Objective Name="Step2_2_Objective1" StartValue="0" EndValue="$CuriosityAmount">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Loop>
                                <!--Spawn Curiosities: just to be sure that the quest is possible/Not too difficult-->
                                <!--Spawned Curiosities: Visible only be the "CurrentEmpire"-->
                                <Action_SpawnCuriosity>
                                    <Input_Empires VarName="$CurrentEmpire"/>
                                    <Input_Planets VarName="$FirstSystemPlanet"/>                                    
                                    <Input_CuriosityDefinition VarName="$CuriosityName"/>
                                </Action_SpawnCuriosity>
                                <Action_SpawnCuriosity>
                                    <Input_Empires VarName="$CurrentEmpire"/>
                                    <Input_Planets VarName="$SecondSystemPlanet"/>
                                    <Input_CuriosityDefinition VarName="$CuriosityName"/>
                                </Action_SpawnCuriosity>
                                <Action_SpawnCuriosity>
                                    <Input_Empires VarName="$CurrentEmpire"/>
                                    <Input_Planets VarName="$ThirdSystemPlanet"/>
                                    <Input_CuriosityDefinition VarName="$CuriosityName"/>
                                </Action_SpawnCuriosity>
                                <Action_SpawnCuriosity>
                                    <Input_Empires VarName="$CurrentEmpire"/>
                                    <Input_Planets VarName="$FourthSystemPlanet"/>
                                    <Input_CuriosityDefinition VarName="$CuriosityName"/>
                                </Action_SpawnCuriosity>
                                <!--The Loop duration depends on the Game Speed-->
                                <Input_Count VarName="$CuriositySpawnLoop"/>
                            </Loop>
                            <Loop>
                                <!--Discover X Curiosities-->
                                <Decorator_CuriosityDiscovered Initiator="Empire" ProgressionIncrement="1">
                                    <Input_DisplayedType VarName="$CuriosityType"/>
                                </Decorator_CuriosityDiscovered>                               
                                <Input_Count VarName="$CuriosityAmount"/>
                            </Loop>
                            <Action_ChooseOutcome Name="Outcome2"/>
                        </Sequence>
                        <Outcome Name="Outcome2">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistScienceChapter1" Picks="1"/>
                </ObjectiveSet>
            </Step>
            
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 2         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter2" Category="MajorQuest" SubCategory="Vampirilis" AlternateVersion="VampirilisQuest-Chapter2Ter">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter2</Tags> 

        <QuestContextSolo/>
        

        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$AllEmpires">
                <From Source="$MajorEmpires"/>
            </Var>
            <Var VarName="$VampirilisEmpire">
                <From Source="$Empires">
                    <Where>
                        <IsNot EntityVarName="$CurrentEmpire"/>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassPopulationEmpireAffinityVampirilis</PathPrerequisite>                   
                    </Where>
                </From>
            </Var>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$HomeConstellation">
                <From Source="$HomeSystem.$Constellation"/>
            </Var>

            <!--Define Location where we spawn Tabernacle-->
            <Var VarName="$TabernacleSystem" AutoLockTargets="true">
                <Any>
                    <From Source="$Constellations.$StarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ClassStarSystem, ConnectedNode</PathPrerequisite>
                            <InterpreterPrerequisite Flags="Prerequisite">Count(Context, @'ClassStarSystem/ClassPlanet') le 2</InterpreterPrerequisite>            
                        </Where>
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Farthest" MinimumDistance="10" MaximumDistance="40" MinimumCandidateCount="1"/>
                        </OrderBy>
                    </From>
                </Any>
            </Var>
            <Var VarName="$TabernaclePlanet">
                <Any>
                    <From Source="$TabernacleSystem.$Planets">                        
                    </From>
                </Any>
            </Var>            
            <Var VarName="$Expression01" StringValue="ClassEmpire/ClassColonizedStarSystem,TabernacleSystem"/>
            <Var VarName="$CuriosityToSpawn" StringValue="Curiosity_Quest_Vampirilis"/>
            <Var VarName="$GUID01"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Marker02"/>
            <Var VarName="$Hero" StringValue="HeroQuestVampirilis01"/>
            <Var VarName="$HeroLevel" IntValue="5"/>
            <Var VarName="$Descriptor01" StringValue="TabernacleSystem"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
            <Var VarName="$NewSystemName" StringValue="TabernacleName"/>
            <LocalizationVar Source="$TabernacleSystem" LocalizationKey="$TabernacleSystemName"/>
            <Var VarName="$TabernacleDescriptor" StringValue="TabernacleSystem"/>
            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis02Religious"/>
            <DroplistVar VarName="$DroppableHero" Droplist="DroplistVampirilisQuestHero01"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
     
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <!--============ STEP 0 - Choose ============-->
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0">
                        <Prerequisites Target="$(Empire)">
                            <GameSettingPrerequisite Flags="NoSuperWeaponsAllowedQuestPrerequisite,Disable">AllowSuperWeapons,True</GameSettingPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                </Choice>
                <!--============ STEP 1 - Industry ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$TabernacleDescriptor"/>
                            <Input_Targets VarName="$TabernacleSystem"/>
                        </Action_ApplyDescriptor>                        
                        <!--REBELLION politic is Neutral-->
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$TabernacleSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_SpawnCuriosity>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Input_Planets VarName="$TabernaclePlanet"/>
                            <Input_CuriosityDefinition VarName="$CuriosityToSpawn"/>
                            <Output_CuriosityGUIDs VarName="$GUID01"/>
                        </Action_SpawnCuriosity>                       
                    </StartActions>
                    <Objective Name="Step2_1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <!--Reveal the Curiosity-->
                            <!--Notice that Hero prerequisite are in the Curiosity Definition itself-->
                            <Decorator_CuriosityDiscovered>
                                <Input_CuriosityGUIDs VarName="$GUID01"/>
                            </Decorator_CuriosityDiscovered>                            
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_SpawnHero>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_HeroDefinition VarName="$Hero"/>
                                <Input_HeroLevel VarName="$HeroLevel"/>
                            </Action_SpawnHero>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward DropVar="$DroppableHero"/>
                </ObjectiveSet>
                <!--============ STEP 2 - RELIGIOUS ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$TabernacleDescriptor"/>
                            <Input_Targets VarName="$TabernacleSystem"/>
                        </Action_ApplyDescriptor>
                        <!--Religious Objective-->
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$TabernacleSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker02"/>
                        </Action_AddQuestMarkers>
                    </StartActions>
                    <Objective Name="Step2_2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />                        
                            <Parallel CompletionPolicy="First">                                
                                <Sequence>   
                                    <Decorator_BeginTurn>
                                        <Condition_CheckPath>
                                            <Input_SimulationObject VarName="$CurrentEmpire"/>
                                            <Input_Path VarName="$Expression01"/>
                                        </Condition_CheckPath>
                                    </Decorator_BeginTurn>  
                                    <Action_RemoveQuestMarkers>
                                        <Input_Markers VarName="$Marker02"/>
                                    </Action_RemoveQuestMarkers>                                   
                                    <Action_ChooseOutcome Name="Outcome1"/>
                                </Sequence>
                                
                                <Sequence>                                   
                                    <Decorator_BeginTurn>
                                        <Condition_CheckPath Composition="Any">
                                            <Input_SimulationObject VarName="$VampirilisEmpire"/>
                                            <Input_Path VarName="$Expression01"/>
                                        </Condition_CheckPath>
                                    </Decorator_BeginTurn>  
                                    <Action_RemoveQuestMarkers>
                                        <Input_Markers VarName="$Marker02"/>
                                    </Action_RemoveQuestMarkers>                                    
                                    <Action_ChooseOutcome Name="Outcome2"/>                                    
                                </Sequence>
                            
                            </Parallel> 
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Religious</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>                       
                        <Outcome Name="Outcome2">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter2Alt</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                        
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward01" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 2         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter2Ter" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter2</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>          
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>
            <Var VarName="$HomeConstellation">
                <From Source="$HomeSystem.$Constellation"/>
            </Var>        
            <!--Define Location where we spawn Tabernacle-->
            <Var VarName="$TabernacleSystem" AutoLockTargets="true">
                <Any>
                    <From Source="$Constellations.$StarSystems">
                        <Where>
                            <PathPrerequisite Flags="Prerequisite">ClassStarSystem, ConnectedNode</PathPrerequisite>
                            <InterpreterPrerequisite Flags="Prerequisite">Count(Context, @'ClassStarSystem/ClassPlanet') le 2</InterpreterPrerequisite>            
                        </Where>
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Farthest" MinimumDistance="10" MaximumDistance="40" MinimumCandidateCount="1"/>
                        </OrderBy>
                    </From>
                </Any>
            </Var>
            <Var VarName="$TabernaclePlanet">
                <Any>
                    <From Source="$TabernacleSystem.$Planets">                        
                    </From>
                </Any>
            </Var>            
            <Var VarName="$CuriosityToSpawn" StringValue="Curiosity_Quest_Vampirilis"/>
            <Var VarName="$GUID01"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$Marker02"/>
            <Var VarName="$Hero" StringValue="HeroQuestVampirilis01"/>
            <Var VarName="$HeroLevel" IntValue="5"/>
            <Var VarName="$Descriptor01" StringValue="TabernacleSystem"/>
            <Var VarName="$Descriptor02" StringValue="CannotBeDestroyed"/>
            <Var VarName="$NewSystemName" StringValue="TabernacleName"/>
            <LocalizationVar Source="$TabernacleSystem" LocalizationKey="$TabernacleSystemName"/>
            <Var VarName="$TabernacleDescriptor" StringValue="TabernacleSystem"/>
            <!--POLITICAL EFFECT LAUNCHED FROM THE BEGINNING-->
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis02Religious"/>
            <DroplistVar VarName="$DroppableHero" Droplist="DroplistVampirilisQuestHero01"/>
        </Vars>

        <!--============ PREREQUISITES ============-->
        
        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <!--============ STEP 0 - Choose ============-->
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0">
                        <Prerequisites Target="$(Empire)">
                            <GameSettingPrerequisite Flags="NoSuperWeaponsAllowedQuestPrerequisite,Disable">AllowSuperWeapons,True</GameSettingPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                </Choice>
                <!--============ STEP 1 - Industry ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$TabernacleDescriptor"/>
                            <Input_Targets VarName="$TabernacleSystem"/>
                        </Action_ApplyDescriptor>                       
                        <!--REBELLION politic is Neutral-->
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$TabernacleSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_SpawnCuriosity>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Input_Planets VarName="$TabernaclePlanet"/>
                            <Input_CuriosityDefinition VarName="$CuriosityToSpawn"/>
                            <Output_CuriosityGUIDs VarName="$GUID01"/>
                        </Action_SpawnCuriosity>                      
                    </StartActions>
                    <Objective Name="Step2_1_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <!--Reveal the Curiosity-->
                            <!--Notice that Hero prerequisite are in the Curiosity Definition itself-->
                            <Decorator_CuriosityDiscovered>
                                <Input_CuriosityGUIDs VarName="$GUID01"/>
                            </Decorator_CuriosityDiscovered>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>                            
                            <Action_SpawnHero>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_HeroDefinition VarName="$Hero"/>
                                <Input_HeroLevel VarName="$HeroLevel"/>
                            </Action_SpawnHero>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward DropVar="$DroppableHero"/>
                </ObjectiveSet>
                <!--============ STEP 2 - RELIGIOUS ============-->
                <ObjectiveSet>
                    <StartActions>
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$TabernacleDescriptor"/>
                            <Input_Targets VarName="$TabernacleSystem"/>
                        </Action_ApplyDescriptor> 
                        <!--Religious Objective-->
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$TabernacleSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker02"/>
                        </Action_AddQuestMarkers>
                        <Action_ApplyDescriptor>
                            <Input_DescriptorName VarName="$Descriptor01"/>
                            <Input_Targets VarName="$TabernacleSystem"/>
                        </Action_ApplyDescriptor>                        
                    </StartActions>
                    <Objective Name="Step2_2_Objective1">   
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />                   
                                <Parallel CompletionPolicy="First">
                                    <Sequence>
                                        <!--Why not only use the Mothership Decorator ?-->
                                        <!--Because this Quest could be launch without MotherShip Affinity-->
                                        <Decorator_ColonizedSystem Initiator="Empire">
                                            <Input_System VarName="$TabernacleSystem"/>
                                        </Decorator_ColonizedSystem>
                                        <Action_RemoveQuestMarkers>
                                            <Input_Markers VarName="$Marker02"/>
                                        </Action_RemoveQuestMarkers>                                        
                                        <Action_ChooseOutcome Name="Outcome1"/>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_BeginTurn>
                                            <Condition_IsSystemOwnedBy>
                                                <Input_Empire VarName="$CurrentEmpire"/>
                                                <Input_System VarName="$TabernacleSystem"/>
                                            </Condition_IsSystemOwnedBy>
                                        </Decorator_BeginTurn>
                                        <Action_RemoveQuestMarkers>
                                            <Input_Markers VarName="$Marker02"/>
                                        </Action_RemoveQuestMarkers>                                       
                                        <Action_ChooseOutcome Name="Outcome1"/>
                                    </Sequence>
                                    <Sequence>
                                        <Decorator_MothershipAttached Initiator="Empire">
                                            <Input_System VarName="$TabernacleSystem"/>
                                        </Decorator_MothershipAttached>
                                        <Action_RemoveQuestMarkers>
                                            <Input_Markers VarName="$Marker02"/>
                                        </Action_RemoveQuestMarkers>                                        
                                        <Action_ChooseOutcome Name="Outcome1"/>
                                    </Sequence> 
                        </Parallel>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Religious</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>                       
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward01" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 2         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter2Alt" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter2Alt</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>

            <Var IsGlobal="true" VarName="$TabernacleSystem"/>
            <Var VarName="$FriendlyVampirilis">
                <From Source="$Empires">
                    <Where>
                        <IsNot EntityVarName="$CurrentEmpire"/>
                        <PathPrerequisite Flags="Prerequisite">ClassEmpire/ClassColonizedStarSystem,TabernacleSystem</PathPrerequisite>
                    </Where>
                </From>
            </Var>
            <Var VarName="$DiplomaticRelationStateName" StringValue="DiplomaticRelationStatePeace"/>

           
        </Vars>

        <!--============ PREREQUISITES ============-->        

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>                    
                    <Objective Name="Step2_2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_DiplomaticRelationChanged>
                                        <Condition_CheckDiplomaticRelation>
                                            <Input_Empire VarName="$CurrentEmpire"/>
                                            <Input_OtherEmpire VarName="$FriendlyVampirilis"/>
                                            <Input_DiplomaticRelationState VarName="$DiplomaticRelationStateName"/>
                                        </Condition_CheckDiplomaticRelation>                                       
                                    </Decorator_DiplomaticRelationChanged>
                                </Sequence>
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_CheckDiplomaticRelation>                                         
                                                <Input_Empire VarName="$CurrentEmpire"/>
                                                <Input_OtherEmpire VarName="$FriendlyVampirilis"/>
                                                <Input_DiplomaticRelationState VarName="$DiplomaticRelationStateName"/>
                                            </Condition_CheckDiplomaticRelation>                                       
                                    </Decorator_BeginTurn>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>                        
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Religious</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward01" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 3         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter3-Religious" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter3-Religious</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>

            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
          
            <Var VarName="$HomeSystems">
                <From Source="$Constellations.$StarSystems">
                    <Where>
                        <PathPrerequisite Flags="Prerequisite">ClassStarSystem,HomeSystem</PathPrerequisite>
                    </Where>
                </From>
            </Var>
            <InterpretedVar VarName="$Amount01" Target="$(Empire)">
                <Expression>Min(5, (Count(Context, @'ClassEmpire/ClassColonizedStarSystem,HomeSystem') + 2))</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$Amount02" Target="$(Empire)">
                <Expression>Min(5,Count(Context, @'ClassEmpire/ClassColonizedStarSystem,HomeSystem'))</Expression>
            </InterpretedVar>

            <Var VarName="$Expression01"      StringValue="Count(Context, @'ClassEmpire/ClassColonizedStarSystem,HomeSystem')"/>
            
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis03Religious"/>
            
            <Var VarName="$HappinessStatusSetEmpireName" StringValue="HappinessStatusSetEmpireQuestVampirilis02"/>
            <Var VarName="$HappinessStatusSetSystemName" StringValue="HappinessStatusSetStarSystemQuestVampirilis02"/>
            
            <LocalizationVar LocalizationKey="$MinAmountName" Source="$Amount01"/>
        </Vars>

        <!--============ PREREQUISITES ============-->     

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">

                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,EmpireTypeMajor,EmpireTypeMajor,AffinityGameplayMajorHisshos</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="1">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite">../ClassEmpire,EmpireTypeMajor,EmpireTypeMajor,AffinityGameplayMajorHisshos</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                </Choice>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective1" StartValue="$Amount02" EndValue="$Amount01">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_IsProgressionComplete>
                                    <Input_Context VarName="$CurrentEmpire"/>
                                    <Input_EmpireWhoseProgressToUpdate VarName="$CurrentEmpire"/>
                                    <Input_Expression VarName="$Expression01"/>
                                </Condition_IsProgressionComplete>
                            </Decorator_BeginTurn>
                             <Action_SetHappinessStatusSet>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_HappinessStatusSetDefinitionName VarName="$HappinessStatusSetEmpireName"/>
                            </Action_SetHappinessStatusSet>
                            <Action_SetHappinessStatusSet>
                                <Input_Empire VarName="$CurrentEmpire"/>
                                <Input_HappinessStatusSetDefinitionName VarName="$HappinessStatusSetSystemName"/>
                            </Action_SetHappinessStatusSet>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Religious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward06" Picks="1"/>
                </ObjectiveSet>
                
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                    </StartActions>
                    <Objective Name="Step1_Objective2" StartValue="$Amount02" EndValue="$Amount01">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="45" MaxAutoResolutionTurn="60" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_IsProgressionComplete>
                                    <Input_Context VarName="$CurrentEmpire"/>
                                    <Input_EmpireWhoseProgressToUpdate VarName="$CurrentEmpire"/>
                                    <Input_Expression VarName="$Expression01"/>
                                </Condition_IsProgressionComplete>
                            </Decorator_BeginTurn>                         
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Religious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistLuxuriesEra5" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>


    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 3         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter3-Rebellious-Step1" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter3-Rebellious-Step1</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$MinAmount01" IntValue="600"/>
            <Var VarName="$ResourceName" StringValue="EmpireEmpirePoint"/>
            <LocalizationVar LocalizationKey="$MinAmount01Name" Source="$MinAmount01"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        
        <Steps>
            <Step Name="Step1">
                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0"/>
                    <ChoiceItem ObjectiveSetIndex="1"/>
                    <ChoiceItem ObjectiveSetIndex="2"/>
                    <ChoiceItem ObjectiveSetIndex="3"/>
                </Choice>
                <ObjectiveSet>
                    <Objective Name="Step1_0_Objective1">
                        <!-- Option 1 -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasResource>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_ResourceName VarName="$ResourceName"/>
                                    <Input_Minimum VarName="$MinAmount01"/>
                                </Condition_HasResource>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>                    
                    <Reward Droplist="DroplistVampirilisReward99a" Picks="1"/>
                    <Reward Droplist="DroplistVampirilisReward99b" Picks="1"/>
                </ObjectiveSet>
                <ObjectiveSet>
                    <Objective Name="Step1_1_Objective1">
                        <!-- Option 2 -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasResource>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_ResourceName VarName="$ResourceName"/>
                                    <Input_Minimum VarName="$MinAmount01"/>
                                </Condition_HasResource>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>                    
                    <Reward Droplist="DroplistVampirilisReward99c" Picks="1"/>
                    <Reward Droplist="DroplistVampirilisReward99d" Picks="1"/>
                </ObjectiveSet>
                <ObjectiveSet>
                    <Objective Name="Step1_2_Objective1">
                        <!-- Option 3 -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasResource>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_ResourceName VarName="$ResourceName"/>
                                    <Input_Minimum VarName="$MinAmount01"/>
                                </Condition_HasResource>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>                    
                    <Reward Droplist="DroplistVampirilisReward99e" Picks="1"/>
                    <Reward Droplist="DroplistVampirilisReward99f" Picks="1"/>
                </ObjectiveSet>
                <ObjectiveSet>
                    <Objective Name="Step1_3_Objective1">
                        <!-- Option 4 -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_HasResource>
                                    <Input_Location VarName="$CurrentEmpire"/>
                                    <Input_ResourceName VarName="$ResourceName"/>
                                    <Input_Minimum VarName="$MinAmount01"/>
                                </Condition_HasResource>
                            </Decorator_BeginTurn>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter3-Rebellious-Step2</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>                    
                    <Reward Droplist="DroplistVampirilisReward99g" Picks="1"/>
                    <Reward Droplist="DroplistVampirilisReward99h" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--           VAMPIRILIS QUEST Chapter 3         -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter3-Rebellious-Step2" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter3-Rebellious-Step2</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>    
            <InterpretedVar VarName="$Amount01" Target="$(Empire)">
                <Expression>Min(4, (MaxProperty(Context, @'../ClassEmpire/ClassColonizedStarSystem', SystemLevel)+1))</Expression>
            </InterpretedVar>
            <Var VarName="$Amount02" IntValue="4"/>
            <LocalizationVar LocalizationKey="$Amount01Name" Source="$Amount01"/>
            <LocalizationVar LocalizationKey="$Amount02Name" Source="$Amount02"/>
        </Vars>

        <!--============ PREREQUISITES ============-->       

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">

                <Choice DefaultChoiceIndex="0">
                    <ChoiceItem ObjectiveSetIndex="0">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite" Inverted="true">../ClassEmpire,EmpireTypeMajor,EmpireTypeMajor,AffinityGameplayMajorHisshos</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                    <ChoiceItem ObjectiveSetIndex="1">
                        <Prerequisites Target="$(Empire)">
                            <PathPrerequisite Flags="Prerequisite">../ClassEmpire,EmpireTypeMajor,EmpireTypeMajor,AffinityGameplayMajorHisshos</PathPrerequisite>
                        </Prerequisites>
                    </ChoiceItem>
                </Choice>
                
                <ObjectiveSet>
                    <Objective Name="Step2_Objective1">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_SystemLevelChanged Initiator="Empire">
                                        <Condition_HasSystems>
                                            <Input_Empires VarName="$CurrentEmpire"/>
                                            <Input_MinimumAmount VarName="$Amount02"/>
                                            <Input_MinimumLevel VarName="$Amount01"/>
                                        </Condition_HasSystems>                                    
                                    </Decorator_SystemLevelChanged>
                                </Sequence>
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_HasSystems>
                                            <Input_Empires VarName="$CurrentEmpire"/>
                                            <Input_MinimumAmount VarName="$Amount02"/>
                                            <Input_MinimumLevel VarName="$Amount01"/>
                                        </Condition_HasSystems>
                                    </Decorator_BeginTurn>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Rebellious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward05" Picks="1"/>
                </ObjectiveSet>

                <ObjectiveSet>
                    <Objective Name="Step2_Objective2">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Parallel CompletionPolicy="Any">
                                <Sequence>
                                    <Decorator_SystemLevelChanged Initiator="Empire">
                                        <Condition_HasSystems>
                                            <Input_Empires VarName="$CurrentEmpire"/>
                                            <Input_MinimumAmount VarName="$Amount02"/>
                                            <Input_MinimumLevel VarName="$Amount01"/>
                                        </Condition_HasSystems>                                    
                                    </Decorator_SystemLevelChanged>
                                </Sequence>
                                <Sequence>
                                    <Decorator_BeginTurn>
                                        <Condition_HasSystems>
                                            <Input_Empires VarName="$CurrentEmpire"/>
                                            <Input_MinimumAmount VarName="$Amount02"/>
                                            <Input_MinimumLevel VarName="$Amount01"/>
                                        </Condition_HasSystems>
                                    </Decorator_BeginTurn>
                                </Sequence>
                            </Parallel>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Rebellious-Step1</Tags>
                                    <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistTechnologyEmpireDevelopment" EvaluationMethod="Dynamic" Picks="1" PreviewLocalizationKey="%RandomTechnologyTitle"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--      VAMPIRILIS QUEST Chapter 4 REBELLIOUS    -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter4-Rebellious-Step1" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter4-Rebellious-Step1</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <InterpretedVar VarName="$PopulationAmount" Target="$(Empire)">
                <Expression>SumProperty(Context, @'ClassEmpire/ClassPopulation', PopulationCount)</Expression>
            </InterpretedVar>
            <InterpretedVar VarName="$TargetAmount" Target="$(Empire)">
                <Expression>$(PopulationAmount)+10</Expression>
            </InterpretedVar>
            <Var VarName="$Expression01" StringValue="SumProperty(Context, @'ClassEmpire/ClassPopulation', PopulationCount)"/>
            <LocalizationVar LocalizationKey="$CurrentEmpireName" Source="$CurrentEmpire"/>
            <LocalizationVar LocalizationKey="$TargetAmountName" Source="$TargetAmount"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Step2_Objective1" StartValue="$PopulationAmount" EndValue="$TargetAmount">
                        <!-- TODO -->
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                      <Sequence>
                        <Parallel CompletionPolicy="First">
                            <Sequence>
                                <Decorator_BeginTurn>
                                    <Condition_IsProgressionComplete>
                                        <Input_Context VarName="$CurrentEmpire"/>
                                        <Input_EmpireWhoseProgressToUpdate VarName="$CurrentEmpire"/>
                                        <Input_Expression VarName="$Expression01"/>
                                    </Condition_IsProgressionComplete>
                                </Decorator_BeginTurn>
                            </Sequence>
                        </Parallel>
                        <Action_ChooseOutcome Name="Outcome1"/>
                      </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Rebellious-Step2Ter</Tags>
                                        <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward03" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>
    
    <!-- #############################################-->
    <!--      VAMPIRILIS QUEST Chapter 4 RELIGIOUS    -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter4-Religious-Step1" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter4-Religious-Step1</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis04Religious"/>
            <Var VarName="$HomeSystem">
                <From Source="$CurrentEmpire.$StartingNode"/>
            </Var>  
            <Var VarName="$CloseSystem">
                <Any>
                    <From Source="$Constellations.$StarSystems">
                        <OrderBy>
                            <SortSystemByDistance OriginVarName="$HomeSystem" SortBy="Farthest" MinimumDistance="10" MaximumDistance="50" MinimumCandidateCount="1"/>
                        </OrderBy>
                    </From>
                </Any>
            </Var>
            <Var VarName="$CloseSystemPlanet">
                <Any>
                    <From Source="$CloseSystem.$Planets"/>
                </Any>
            </Var>
            <Var VarName="$QuestCuriosity" StringValue="Curiosity_Quest_Vampirilis2"/>
            <Var VarName="$Marker01"/>
            <Var VarName="$QuestCuriosityGUID"/>
            <Var VarName="$Amount" IntValue="20"/>
            <Var VarName="$Amount02" IntValue="-20"/>
            <Var VarName="$ResourceName" StringValue="Strategic3"/>
            <LocalizationVar LocalizationKey="$AmountName" Source="$Amount"/>
            <LocalizationVar LocalizationKey="$CloseSystemPlanetName" Source="$CloseSystemPlanet"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>
                        <Action_AddQuestMarkers RevealsLocation="true">
                            <Input_Targets VarName="$CloseSystem"/>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Output_Markers VarName="$Marker01"/>
                        </Action_AddQuestMarkers>
                        <Action_SpawnCuriosity>
                            <Input_Empires VarName="$CurrentEmpire"/>
                            <Input_Planets VarName="$CloseSystemPlanet"/>
                            <Input_CuriosityDefinition VarName="$QuestCuriosity"/>
                            <Output_CuriosityGUIDs VarName="$QuestCuriosityGUID"/>
                        </Action_SpawnCuriosity>
                    </StartActions>
                    <Objective Name="Step2_Objective1">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_CuriosityDiscovered Initiator="Empire">
                                <Input_CuriosityGUIDs VarName="$QuestCuriosityGUID"/>
                            </Decorator_CuriosityDiscovered>
                            <Action_TransferResource>
                                <Input_Location VarName="$CurrentEmpire"/>
                                <Input_ResourceName VarName="$ResourceName"/>
                                <Input_Amount VarName="$Amount02"/>
                            </Action_TransferResource>
                            <Action_RemoveQuestMarkers>
                                <Input_Markers VarName="$Marker01"/>
                            </Action_RemoveQuestMarkers>
                            <Action_ChooseOutcome Name="Outcome1"/>
                        </Sequence>
                        <Outcome Name="Outcome1">
                            <Triggers Weight="1">
                                <QuestTrigger>
                                    <Tags>VampirilisQuest-Chapter4-Religious-Step2</Tags>
                                        <QuestContextSolo ParticipantsVarName="$CurrentEmpire"/>
                                </QuestTrigger>
                            </Triggers>
                        </Outcome>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward04" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--      VAMPIRILIS QUEST Chapter 4 REBELLIOUS    -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter4-Rebellious-Step2Ter" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter4-Rebellious-Step2Ter,VampirilisQuest-Chapter4-Rebellious-Step2,FactionFinalQuest,FactionQuestVampirilis</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$Path01" StringValue="ClassEmpire/ClassStarSystem/ClassImprovement,StarSystemImprovementQuestVampirilis06"/>

            <Var VarName="$ConstructibleAcademy" StringValue="StarSystemImprovementQuestVampirilis06"/>
            <LocalizationVar LocalizationKey="$ConstructibleAcademyName" Source="$ConstructibleAcademy"/>       
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <Objective Name="Step2_Objective1">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_CheckPath>
                                    <Input_SimulationObject VarName="$CurrentEmpire"/>
                                    <Input_Path VarName="$Path01"/>                                    
                                </Condition_CheckPath>
                            </Decorator_BeginTurn>
                        </Sequence>
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward11" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

    <!-- #############################################-->
    <!--      VAMPIRILIS QUEST Chapter 4 RELIGIOUS    -->
    <!-- #############################################-->

    <QuestDefinition Name="VampirilisQuest-Chapter4-Religious-Step2" Category="MajorQuest" SubCategory="Vampirilis">

        <!--============ TAGS ============-->
        <Tags>VampirilisQuest-Chapter4-Religious-Step2, FactionFinalQuest,FactionQuestVampirilis</Tags>

        <QuestContextSolo/>


        <RepetitionRules  NumberOfOccurrencesPerGame="0"
                          NumberOfOccurrencesPerEmpire="1"
                          NumberOfConcurrentInstances="0"/>

        <!--============ VARIABLES ============-->
        <Vars>
            <Var VarName="$CurrentEmpire">
                <From Source="$Empire"/>
            </Var>
            <Var VarName="$PoliticalEffectReligious" StringValue="PopulationEventVampirilis05Religious"/>
            <Var VarName="$Path01" StringValue="ClassEmpire/ClassStarSystem/ClassImprovement,StarSystemImprovementQuestVampirilis07"/>

            <Var VarName="$ConstructibleAcademy" StringValue="StarSystemImprovementQuestVampirilis07"/>
            <LocalizationVar LocalizationKey="$ConstructibleAcademyName" Source="$ConstructibleAcademy"/>
        </Vars>

        <!--============ PREREQUISITES ============-->

        <!--============ STEPS ============-->
        <Steps>
            <Step Name="Step1">
                <ObjectiveSet>
                    <StartActions>
                        <Action_TriggerPopulationEvent>
                            <Input_Empire VarName="$CurrentEmpire"/>
                            <Input_Target VarName="$CurrentEmpire"/>
                            <Input_PopulationEventDefinition VarName="$PoliticalEffectReligious"/>
                        </Action_TriggerPopulationEvent>                      
                    </StartActions>
                    <Objective Name="Step2_Objective1">
                        <AIHint Category="Minimal" MinAutoResolutionTurn="25" MaxAutoResolutionTurn="35" AutoResolutionProbability="1" />
                        <Sequence>
                            <Decorator_BeginTurn>
                                <Condition_CheckPath>
                                    <Input_SimulationObject VarName="$CurrentEmpire"/>
                                    <Input_Path VarName="$Path01"/>                                    
                                </Condition_CheckPath>
                            </Decorator_BeginTurn>           
                        </Sequence>                        
                    </Objective>
                    <Reward Droplist="DroplistVampirilisReward10" Picks="1"/>
                </ObjectiveSet>
            </Step>
        </Steps>
    </QuestDefinition>

</Datatable>